<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aviokompanija</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Bootstrap JS and jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h2 class="text-center mb-4">Podaci o aviokompaniji</h2>

        <div id="aviokompanijaDetails"></div>
    </div>

    <script>
        $(document).ready(function () {
            const urlParams = new URLSearchParams(window.location.search);
            const aviokompanijaId = urlParams.get('id');

            if (aviokompanijaId) {
                // Učitavanje podataka o aviokompaniji na osnovu ID-ja
                $.get(`/api/aviokompanije/${aviokompanijaId}`, function (aviokompanija) {
                    const aviokompanijaDetails = $('#aviokompanijaDetails');

                    const aviokompanijaElement = `
                            <div>
                                <h5>${aviokompanija.Naziv}</h5>
                                <p><strong>Adresa:</strong> ${aviokompanija.Adresa}</p>
                                <p><strong>Kontakt:</strong> ${aviokompanija.KontaktInformacije}</p>
                                <h6>Letovi:</h6>
                                <ul>
                                    ${generateLetoviList(aviokompanija.Letovi)}
                                </ul>
                                <h6>Recenzije:</h6>
                                <ul>
                                    ${generateRecenzijeList(aviokompanija.Recenzije)}
                                </ul>
                            </div>
                        `;
                    aviokompanijaDetails.html(aviokompanijaElement);
                }).fail(function (jqXHR, textStatus, errorThrown) {
                    console.error('Greška prilikom učitavanja podataka o aviokompaniji:', textStatus, errorThrown);
                });
            } else {
                // Ukoliko ne postoji ID, možete uputiti korisnika nazad na stranicu sa listom aviokompanija
                console.error('Nedostaje ID aviokompanije.');
                window.location.href = 'index.html';
            }
        });

        function generateLetoviList(letovi) {
            let letoviList = '';
            if (letovi.length > 0) {
                letovi.forEach(let => {
                    letoviList += `
                            <li>
                                ${let.PolaznaDestinacija} - ${let.OdredisnaDestinacija}, Polazak: ${new Date(let.DatumVremePolaska).toLocaleString()}, Dolazak: ${new Date(let.DatumVremeDolaska).toLocaleString()}, Mesta: ${let.BrojSlobodnihMesta}, Cena: $${let.Cena}
                            </li>
                        `;
                });
            } else {
                letoviList = '<li>Nema dostupnih letova.</li>';
            }
            return letoviList;
        }


        function generateRecenzijeList(recenzije) {
            let recenzijeList = '';
            if (recenzije.length > 0) {
                recenzije.forEach(recenzija => {
                    if (recenzija.Status === 1) { // Assuming 1 corresponds to "Odobrena"
                        recenzijeList += `
                <li>
                    <h5>${recenzija.Recezent}</h5>`;

                        if (recenzija.Slika && recenzija.Slika.trim() !== "") {
                            const imageUrl = encodeURI(recenzija.Slika);
                            recenzijeList += `<img src='${imageUrl}' alt='${recenzija.Naslov}' style='width: 100px; height: auto;'>`;
                            
                        }

                        recenzijeList += `<p>${recenzija.Sadrzaj}</p>
                </li>`;
                    }
                });
            } else {
                recenzijeList = '<li>Nema dostupnih recenzija.</li>';
            }
            return recenzijeList;
        }
    </script>
</body>
</html>
